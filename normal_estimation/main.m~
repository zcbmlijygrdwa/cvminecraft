close all
clear all

p = [0,0,0
    0,1,0
    1,0,0];

p1 = p(1,:);

p2 = p(2,:);

p3 = p(3,:);

a1 = p2-p1;
a2 = p3-p1;


n = cross(a1,a2);

dimage = zeros(20,20);

img = imread('/home/zhenyu/Pictures/test.jpeg');
img = rgb2gray(img);


for i=1:size(img,1)
    for j=1:size(img,2)
        dimage(i,j) = sqrt(i+j)*sqrt(i);
    end
end

dimage = double(img);

output = {};
outputIdx = 1;
for i=1:size(img,1)
    for j=1:size(img,2)
        if(i+1<=size(img,1) && j+1 <=size(img,2))
            p1 = [i,j,dimage(i,j)];
            p2 = [i+1,j,dimage(i+1,j)];
            p3 = [i,j+1,dimage(i,j+1)];
            
            a1 = p2-p1;
            a2 = p3-p1;
            
            n = cross(a1,a2);
            n = n/norm(n);
            output{outputIdx}.location = p1;
            output{outputIdx}.n = n;
            outputIdx = outputIdx+1;
        end
    end
end



%show
x = [];
y = [];
z = [];
idx = 1;
for i=1:size(img,1)
    for j=1:size(img,)
        x(idx) = i;
        y(idx) = j;
        z(idx) = dimage(i,j);
        idx = idx+1;
    end
end

scatter3(x,y,z);
daspect([1 1 1])
hold on;
for i = 1:length(output)
    mArrow3(output{i}.location,output{i}.location+output{i}.n, 'stemWidth', 0.05); 
end
hold off;